/*
 ============================================================================
 Name        : Parcial_[nroUno].c
 Author      : 
 Version     :
 Copyright   : Your copyright notice
 Description : Hello World in C, Ansi-style
 ============================================================================
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>
#include "UTN.h"

#include "censista.h"
#include "vivienda.h"
#define TAM 5
#define LEN 3
#define LENNAME 25

int main(void) {
	setbuf(stdout,NULL);
	int id = 20000;
	char opcion;
	int espacioLibre;
	int flagAlta = 0;
	int auxId;
	int auxIndice;

	int auxFx;

	eVivienda aViviendas [TAM];
	eCensista aCencistas [LEN] = //{{100,"Ana",34,{'1','2','0','3','-','2','3','4','5'}},
								 //{101,"Juan",24,{'4','3','0','1','-','5','4','6','7','8'}},
								 //{102,"Sol",47,{'5','9','0','2','-','3','7','4','8','7'}}};
	 	 	 	 	 	 	 	 {{100,"Ana",34,"1203-2345"},{101,"Juan",24,"4301-54678"}, {102,"Sol",47,"5902-37487"}};

	void (*pFx)(eVivienda* aViviendas,int,int*);

	pFx = initVivienda;
	auxFx = PrimerPuntero(aViviendas, TAM, pFx);

//	if (initVivienda (aViviendas,TAM) == 0){
	if (auxFx == 0){

		do{	 if( utn_getNumeroCaracter(&opcion, "\n\n \t *** MENU DE OPCIONES *** \n\nPor favor ingrese una opcion: \n\n\n"

				"\n a) Alta Vivienda.\n"
				"\n b) Modificar.\n"
				"\n c) Baja Vivienda.\n"
				"\n d) Listar Viviendas.\n"
				"\n e) Listar Censistas.\n"
				"\n f) Salir.\n"

				, "ERROR. \nLa opcion es incorrecta.\nPor favor ingrese una de las opciones del menu.", 'a', 'f', 4) == 0) {

				switch (opcion){

				case 'a':// ALTA
						printCensistas(aCencistas, LEN);

						if(	buscarEmptyLibre(aViviendas, TAM, &espacioLibre)== 0 &&
							utn_getNumero(&aViviendas[espacioLibre].legajoCensista,
							"\nIngrese el numero de legajo del censista.","\nError. \n",100,102,3)==0 &&
						//	addVivienda (aViviendas,LENNAME,espacioLibre,&id) == 0)
							addVivienda(&aViviendas[espacioLibre],LENNAME,&id)== 0)
						{
							printf("\n\nCarga realizada con EXITO\n\n");
							flagAlta = 1;
						}
						else
						{
							printf("\n\nERROR");
						}

					break;

				case 'b': // MODIFICAR
						pFx = printViviendas;
						auxFx = PrimerPuntero(aViviendas, TAM, pFx);

						//if(flagAlta == 1 && printViviendas (aViviendas, TAM) == 0 &&
						if(flagAlta == 1 && auxFx == 0 &&
							utn_getNumero(&auxId,"\nIngrese el id de la vivienda que desea modificar.\n (entre 20000 y 21000\n",
							"\nError \n",20000,21000,3) == 0 && findViviendaById(aViviendas,TAM,auxId,&auxIndice) == 0)


						{
							viviendaSoloPrint(&aViviendas[auxIndice]);
							vivienda_modificarMenu(&aViviendas[auxIndice]);
						}
					break;

				case 'c': // BAJA
			//			if(flagAlta == 1 && printViviendas(aViviendas, TAM) == 0 && utn_getNumero(&auxId,
						if(flagAlta == 1 &&  auxFx == 0 && utn_getNumero(&auxId,
						"\n\n\nIngrese el id de la vivienda que desea dar de baja.\n","\nError \n",20000,21000,2) == 0 &&
						findViviendaById(aViviendas,TAM ,auxId,&auxIndice) == 0 && removeVivienda(&aViviendas[auxIndice]) ==0)
						{
							printf("\n\nBaja exitosa");
						}
						else{
							printf("\n\nERROR. La baja no pudo realizarse con exito");
						}

					break;

				case 'd': // LISTAR VIVIENDAS CALLE y cant personas
						pFx = ListarViviendasCalleCant;
						auxFx = PrimerPuntero(aViviendas, TAM, pFx);

						if (flagAlta == 1 && ListarViviendasCalleCant(aViviendas,TAM) == 0)
						{
							printViviendas (aViviendas,TAM);
						}

					break;

				case 'e': // LISTAR CENSISTAS
						printCensistas(aCencistas,LEN);

					break;

				}

		}

		}while (opcion != 'f');

	}

	return EXIT_SUCCESS;
}
